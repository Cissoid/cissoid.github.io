<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Vim on B-log</title><link>https://blog.wxh.me/tags/vim/</link><description>Recent content in Vim on B-log</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>cissoid</copyright><lastBuildDate>Wed, 11 May 2016 15:58:18 +0800</lastBuildDate><atom:link href="https://blog.wxh.me/tags/vim/index.xml" rel="self" type="application/rss+xml"/><item><title>一个简单的 Vim 文件模板插件</title><link>https://blog.wxh.me/post/2016/05/a-simple-vim-template-plugin/</link><pubDate>Wed, 11 May 2016 15:58:18 +0800</pubDate><guid>https://blog.wxh.me/post/2016/05/a-simple-vim-template-plugin/</guid><description>&lt;p>最近尝试了一下在 Vim 中实现一个简单的文件模板功能, 总共只写了 3 个函数就完成了自己的需求,
再次体现出 Vim 强大的可定制性.&lt;/p>
&lt;h1 id="1-创建新文件时自动填入模板">1. 创建新文件时自动填入模板.&lt;/h1>
&lt;h2 id="11-编写一个简单的模板-以-c-语言的模板为例">1.1. 编写一个简单的模板, 以 C 语言的模板为例.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-C" data-lang="C">&lt;span style="color:#75715e">/*
&lt;/span>&lt;span style="color:#75715e"> * File Name: [:VIM_EVAL:]expand(&amp;#39;%:t&amp;#39;)[:END_EVAL:]
&lt;/span>&lt;span style="color:#75715e"> * Author:
&lt;/span>&lt;span style="color:#75715e"> * Created At: [:VIM_EVAL:]strftime(&amp;#39;%Y-%m-%d %H:%M:%S&amp;#39;)[:END_EVAL:]
&lt;/span>&lt;span style="color:#75715e"> * Last Modified: [:VIM_EVAL:]strftime(&amp;#39;%Y-%m-%d %H:%M:%S&amp;#39;)[:END_EVAL:]
&lt;/span>&lt;span style="color:#75715e"> */&lt;/span>
&lt;span style="color:#75715e">#include&lt;/span> &lt;span style="color:#75715e">&amp;lt;stdio.h&amp;gt;&lt;/span>&lt;span style="color:#75715e">
&lt;/span>&lt;span style="color:#75715e">&lt;/span>
&lt;span style="color:#66d9ef">int&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> argc, &lt;span style="color:#66d9ef">char&lt;/span> &lt;span style="color:#f92672">**&lt;/span>argv) {
printf(&lt;span style="color:#e6db74">&amp;#34;Hello World&lt;/span>&lt;span style="color:#ae81ff">\n&lt;/span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>);
&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#ae81ff">0&lt;/span>;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>其中使用 &lt;code>[:VIM_EVAL:][:END_EVAL:]&lt;/code> 来作为替换变量的标志. 中间的部分会使用 &lt;code>eval()&lt;/code> 执行.&lt;/p>
&lt;h2 id="12-在-vimrc-中添加如下函数">1.2. 在 vimrc 中添加如下函数.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Vim" data-lang="Vim">&lt;span style="color:#66d9ef">function&lt;/span>! &lt;span style="color:#a6e22e">s&lt;/span>:&lt;span style="color:#a6e22e">AddFileTemplate&lt;/span>(&lt;span style="color:#a6e22e">filetype&lt;/span>)&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">template&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;~/.vim/templates/&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">a&lt;/span>:&lt;span style="color:#a6e22e">filetype&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;.template&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">writecmd&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;0read &amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">template&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">execute&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">writecmd&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">exec_line&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;1,&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">min&lt;/span>([&lt;span style="color:#a6e22e">line&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;$&amp;#39;&lt;/span>), &lt;span style="color:#ae81ff">10&lt;/span>])&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_regex&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;\[:VIM_EVAL:\](.+)\[:END_EVAL:\]&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_func&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;\=eval(submatch(1))&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">execcmd&lt;/span> = &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">exec_line&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;s/\v\C&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_regex&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_func&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;/g&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">execute&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">execcmd&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">endfunction&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>这里假定模板文件是放置在 &lt;code>~/.vim/templates&lt;/code> 目录下.&lt;/p>
&lt;h2 id="13-增加-autocmd-当新建文件时自动填入模板">1.3. 增加 autocmd, 当新建文件时自动填入模板.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Vim" data-lang="Vim">&lt;span style="color:#a6e22e">autocmd&lt;/span> &lt;span style="color:#a6e22e">BufNewFile&lt;/span> *.&lt;span style="color:#a6e22e">h&lt;/span>,*.&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#a6e22e">call&lt;/span> &lt;span style="color:#a6e22e">s&lt;/span>:&lt;span style="color:#a6e22e">AddFileTemplate&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;c&amp;#39;&lt;/span>)&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="2-保存文件时自动更新时间戳">2. 保存文件时自动更新时间戳.&lt;/h1>
&lt;h2 id="21-在-vimrc-中添加如下函数">2.1. 在 vimrc 中添加如下函数.&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Vim" data-lang="Vim">&lt;span style="color:#66d9ef">function&lt;/span>! &lt;span style="color:#a6e22e">s&lt;/span>:&lt;span style="color:#a6e22e">UpdateFileTemplate&lt;/span>()&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">exec_line&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;1,&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">min&lt;/span>([&lt;span style="color:#a6e22e">line&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;$&amp;#39;&lt;/span>), &lt;span style="color:#ae81ff">10&lt;/span>])&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">modify_regex&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;(Last Modified: )@&amp;lt;=([0-9]{4}-[0-9]{2}-[0-9]{2} [0-9]{2}:[0-9]{2}:[0-9]{2})&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#66d9ef">let&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_func&lt;/span> = &lt;span style="color:#e6db74">&amp;#39;\=eval(&amp;#34;strftime(\&amp;#34;%Y-%m-%d %H:%M:%S\&amp;#34;)&amp;#34;)&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">normal&lt;/span>! &lt;span style="color:#a6e22e">mm&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">execute&lt;/span> &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">exec_line&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;s/\v\C&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">modify_regex&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span> . &lt;span style="color:#a6e22e">l&lt;/span>:&lt;span style="color:#a6e22e">eval_func&lt;/span> . &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">normal&lt;/span>! &amp;#39;&lt;span style="color:#a6e22e">m&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">execute&lt;/span> &lt;span style="color:#e6db74">&amp;#39;delmarks m&amp;#39;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span> &lt;span style="color:#a6e22e">silent&lt;/span>! &lt;span style="color:#a6e22e">normal&lt;/span>! &lt;span style="color:#a6e22e">zz&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&lt;/span>&lt;span style="color:#66d9ef">endfunction&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="22-增加-autocmd">2.2. 增加 autocmd&lt;/h2>
&lt;div class="highlight">&lt;pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-Vim" data-lang="Vim">&lt;span style="color:#a6e22e">autocmd&lt;/span> &lt;span style="color:#a6e22e">BufWritePre&lt;/span> *.&lt;span style="color:#a6e22e">h&lt;/span>,*.&lt;span style="color:#a6e22e">c&lt;/span> &lt;span style="color:#a6e22e">call&lt;/span> &lt;span style="color:#a6e22e">s&lt;/span>:&lt;span style="color:#a6e22e">UpdateFileTemplate&lt;/span>()&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>