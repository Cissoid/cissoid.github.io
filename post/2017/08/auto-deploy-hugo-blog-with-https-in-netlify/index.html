<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=theme-color content="#F5F7F9"><title>使用 Netlify 自动部署支持 HTTPS 的 Hugo 博客 | B-log</title><link rel=stylesheet href=/css/minimalism.css><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-67524885-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><header><div class=container><h1><a href=/>B-log</a></h1><nav><ul><li>&nbsp;|&nbsp;</li><li><a href=/post/>Post</a></li><li>&nbsp;|&nbsp;</li><li><a href=/about/>About</a></li><li>&nbsp;|&nbsp;</li></ul></nav></div><hr></header><main><article class=post><header><h1>使用 Netlify 自动部署支持 HTTPS 的 Hugo 博客</h1><ul class=description><li><time>2017-08-07</time></li></ul></header><section class=license><p><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/><img alt="Creative Commons License" src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a><br>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/>Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p></section><section class=post><p>自动部署静态站点的方法有很多, 例如我之前使用过的 <a href=https://travis-ci.org>Travis CI</a>,
或是使用 github 原生支持的 <a href=https://jekyllrb.com/>jekyll</a>, 即使是通过 webhook
来自己实现也很简单. 今天要介绍的 Netlify 在自动部署这一块并没有什么特别之处,
它的优势在于: 支持自定义域名的 HTTPS.</p><p>在知道 Netlify 之前, 我所了解的可以让静态站点使用 HTTPS 的方式有两种:</p><ol><li>托管到自己的服务器上. 这样当然想怎么折腾都可以, 但这样总感觉失去了静态博客的意义,
而且有一定的门槛: 需要有自己的服务器. 而且我并不想为此耗费自己服务器的带宽和资源,
也不想暴露服务器的 ip.</li><li>使用 <a href=https://www.cloudflare.com>Cloudflare</a> 的 NS 服务, 利用其提供的 <code>Universal SSL</code>
服务提供 HTTPS. 但是这样做需要把域名的 NS 服务迁到 Cloudflare, 也有点得不偿失了.
另外 Cloudflare CDN 连国内的速度貌似不怎么样, 也不知道 NS 服务又是什么情况.</li></ol><p>而 Netlify 可以说是完美解决了以上两点, 首先, 站点是托管在 Netlify 的服务器上;
其次, 只需要加一条 CNAME 记录, 即可为站点加上 HTTPS 支持. 至少比较完美地满足了我的需求.</p><p>首先, 注册好 Netlify 账号后, 选择 <code>New site from Git</code>, 就可以通过 OAuth 的方式获取指定
repo 的访问权限, 同时也会向该 repo 增加一个 Deploy Key. 对于 Hugo 站点,
创建时的 Build command 应该填为 <code>pip install -U pygments; hugo -v</code>, 并且 Publish
directory 填为 <code>public</code>. 创建成功之后就会开始第一次构建.</p><p>在一开始的测试中, 我发现回报这样一个错误: <code>Unable to locate template for shortcode 'instagram'</code>,
按道理来说 <code>instagram</code> 这个 shortcode 是 hugo 内置的, 不应该找不到, 有可能是版本问题.
一查之下, 果然这个 shortcode 是在 Hugo 0.20 版本才加入的, 而 Netlify 默认使用的版本是 0.17.
解决方式是在项目 repo 中增加一个 <code>netlify.toml</code> 文件, 并加入以下内容:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=color:#66d9ef>[context.production.environment]</span>
    <span style=color:#a6e22e>HUGO_VERSION</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;0.25.1&#34;</span>
</code></pre></div><p>就可以指定使用的 Hugo 版本.</p><p>配置好自动部署后, 再将自定义的域名 CNAME 到对应的 Netlify 二级域名下, 并在 Netlify
中配置好 Let&rsquo;s Encrypt 证书就可以了.</p></section></article></main><footer><hr><div class=container><div class=copyright>&copy;2017-2019 By cissoid.</div><div class=about>Built with <a href=https://gohugo.io>Hugo</a>, using theme <a href=https://github.com/cissoid/hugo-theme-minimalism>Minimalism</a>.</div></div></footer><div id=mask><div id=loading><div></div></div></div><script src=/js/minimalism.js></script></body></html>